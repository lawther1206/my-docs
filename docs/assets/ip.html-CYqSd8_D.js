import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as s,b as i,d as r,o as l}from"./app-cQLVBdqJ.js";const t={};function p(d,e){return l(),n("div",null,[e[0]||(e[0]=s("h1",{id:"ğŸ”ï¸è·å–ipæ–¹æ¡ˆ",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ğŸ”ï¸è·å–ipæ–¹æ¡ˆ"},[s("span",null,"ğŸ”ï¸è·å–IPæ–¹æ¡ˆ")])],-1)),i(" more "),e[1]||(e[1]=r(`<h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€"><span>å‰è¨€</span></a></h2><p>ä¸¤ç§æ–¹æ¡ˆçš„å‰æéƒ½æ˜¯éœ€è¦<code>Nginx</code>é…ç½®ï¼Œå¹¶ä¸”æœ¬åœ°é˜¶æ®µéƒ½æ— æ³•è·å–åˆ°æ­£ç¡®çš„å…¬ç½‘IPï¼ˆæç¤ºè·å–::1ï¼‰ï¼Œéœ€è¦æœåŠ¡å™¨éƒ¨ç½²åˆ°çº¿ä¸Šåæ‰èƒ½æ­£ç¡®è·å–</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//Nginxé…ç½®</span></span>
<span class="line"><span>location /api/ {</span></span>
<span class="line"><span>    rewrite ^/api/(.*)$ /$1 break; </span></span>
<span class="line"><span>    proxy_pass http://your_backend_server;  </span></span>
<span class="line"><span>    proxy_set_header Host $host;  </span></span>
<span class="line"><span>    proxy_set_header X-Real-IP $remote_addr;  </span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; </span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-Proto $scheme;  </span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ–¹æ¡ˆä¸€" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆä¸€"><span>æ–¹æ¡ˆä¸€</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>var realIP = &quot;&quot;;</span></span>
<span class="line"><span>var forwardedFor = req.headers[&quot;x-forwarded-for&quot;];</span></span>
<span class="line"><span>if (forwardedFor &amp;&amp; forwardedFor !== &quot;&quot;)</span></span>
<span class="line"><span>realIP = forwardedFor.split(&quot;,&quot;).pop().trim();</span></span>
<span class="line"><span>else realIP = req.ip;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆæ£€æŸ¥<code>X-Forwarded-For</code>å­—æ®µæ˜¯å¦å­˜åœ¨ä¸”ä¸ä¸ºç©ºï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä½¿ç”¨splitæ–¹æ³•åˆ‡å‰²å­—ç¬¦ä¸²å¹¶å–æœ€åä¸€ä¸ªIPåœ°å€ä½œä¸ºçœŸå®IPã€‚å¦‚æœ<code>X-Forwarded-For</code>ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨req.ipè·å–ç”¨æˆ·çš„ IP åœ°å€</p><h2 id="æ–¹æ¡ˆäºŒ" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆäºŒ"><span>æ–¹æ¡ˆäºŒ</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ &#39;request-ip&#39;</span></span>
<span class="line"><span>pnpm i request-ip</span></span>
<span class="line"><span>// app.jsä¸­å¼•å…¥ä½¿ç”¨</span></span>
<span class="line"><span>const requestIp = require(&#39;request-ip&#39;);</span></span>
<span class="line"><span>app.use(requestIp.mw());</span></span>
<span class="line"><span>// å…·ä½“çš„controllers</span></span>
<span class="line"><span>const clientIp = req.clientIp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>request-ip</code>ä½œä¸ºä¸­é—´ä»¶ï¼ŒæŠŠIPåœ°å€å‚¨å­˜åˆ°<code>clientIp</code>å­—æ®µã€‚æˆ‘ä»¬é€šè¿‡<code>req.clientIp</code>å°±å¯ä»¥è·å–åˆ°çœŸå®IP</p><h2 id="æœ€å" tabindex="-1"><a class="header-anchor" href="#æœ€å"><span>æœ€å</span></a></h2><p>æœ¬æ–‡åªå®ç°<code>express</code>è·å–IPçš„æ–¹æ¡ˆï¼Œå…·ä½“è·å–è¯¦ç»†åœ°å€ä»¥åŠè¿è¥å•†ç­‰ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…è¯¦ç»†èµ„æ–™</p>`,11))])}const h=a(t,[["render",p],["__file","ip.html.vue"]]),m=JSON.parse('{"path":"/posts/ip.html","title":"ğŸ”ï¸è·å–IPæ–¹æ¡ˆ","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2024-05-10T00:00:00.000Z","category":["ä¸šåŠ¡"],"tag":["ä¸€èˆ¬"],"head":[["meta",{"property":"og:url","content":"https://github.com/lawther1206/my-docs/posts/ip.html"}],["meta",{"property":"og:title","content":"ğŸ”ï¸è·å–IPæ–¹æ¡ˆ"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-17T08:43:41.000Z"}],["meta",{"property":"article:tag","content":"ä¸€èˆ¬"}],["meta",{"property":"article:published_time","content":"2024-05-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-17T08:43:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ğŸ”ï¸è·å–IPæ–¹æ¡ˆ\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-05-10T00:00:00.000Z\\",\\"dateModified\\":\\"2025-02-17T08:43:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"leeyng\\",\\"url\\":\\"\\"}]}"]]},"headers":[{"level":2,"title":"å‰è¨€","slug":"å‰è¨€","link":"#å‰è¨€","children":[]},{"level":2,"title":"æ–¹æ¡ˆä¸€","slug":"æ–¹æ¡ˆä¸€","link":"#æ–¹æ¡ˆä¸€","children":[]},{"level":2,"title":"æ–¹æ¡ˆäºŒ","slug":"æ–¹æ¡ˆäºŒ","link":"#æ–¹æ¡ˆäºŒ","children":[]},{"level":2,"title":"æœ€å","slug":"æœ€å","link":"#æœ€å","children":[]}],"git":{"createdTime":1739781821000,"updatedTime":1739781821000,"contributors":[{"name":"liyong","username":"liyong","email":"1074681225@qq.com","commits":1,"url":"https://github.com/liyong"}]},"readingTime":{"minutes":1.01,"words":304},"filePathRelative":"posts/ip.md","localizedDate":"2024å¹´5æœˆ10æ—¥","excerpt":"\\n"}');export{h as comp,m as data};
