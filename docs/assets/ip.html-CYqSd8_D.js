import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as s,b as i,d as r,o as l}from"./app-cQLVBdqJ.js";const t={};function p(d,e){return l(),n("div",null,[e[0]||(e[0]=s("h1",{id:"🏔️获取ip方案",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#🏔️获取ip方案"},[s("span",null,"🏔️获取IP方案")])],-1)),i(" more "),e[1]||(e[1]=r(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>两种方案的前提都是需要<code>Nginx</code>配置，并且本地阶段都无法获取到正确的公网IP（提示获取::1），需要服务器部署到线上后才能正确获取</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//Nginx配置</span></span>
<span class="line"><span>location /api/ {</span></span>
<span class="line"><span>    rewrite ^/api/(.*)$ /$1 break; </span></span>
<span class="line"><span>    proxy_pass http://your_backend_server;  </span></span>
<span class="line"><span>    proxy_set_header Host $host;  </span></span>
<span class="line"><span>    proxy_set_header X-Real-IP $remote_addr;  </span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; </span></span>
<span class="line"><span>    proxy_set_header X-Forwarded-Proto $scheme;  </span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="方案一" tabindex="-1"><a class="header-anchor" href="#方案一"><span>方案一</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>var realIP = &quot;&quot;;</span></span>
<span class="line"><span>var forwardedFor = req.headers[&quot;x-forwarded-for&quot;];</span></span>
<span class="line"><span>if (forwardedFor &amp;&amp; forwardedFor !== &quot;&quot;)</span></span>
<span class="line"><span>realIP = forwardedFor.split(&quot;,&quot;).pop().trim();</span></span>
<span class="line"><span>else realIP = req.ip;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先检查<code>X-Forwarded-For</code>字段是否存在且不为空，如果存在，则使用split方法切割字符串并取最后一个IP地址作为真实IP。如果<code>X-Forwarded-For</code>不存在或为空，则使用req.ip获取用户的 IP 地址</p><h2 id="方案二" tabindex="-1"><a class="header-anchor" href="#方案二"><span>方案二</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//使用第三方库 &#39;request-ip&#39;</span></span>
<span class="line"><span>pnpm i request-ip</span></span>
<span class="line"><span>// app.js中引入使用</span></span>
<span class="line"><span>const requestIp = require(&#39;request-ip&#39;);</span></span>
<span class="line"><span>app.use(requestIp.mw());</span></span>
<span class="line"><span>// 具体的controllers</span></span>
<span class="line"><span>const clientIp = req.clientIp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>request-ip</code>作为中间件，把IP地址储存到<code>clientIp</code>字段。我们通过<code>req.clientIp</code>就可以获取到真实IP</p><h2 id="最后" tabindex="-1"><a class="header-anchor" href="#最后"><span>最后</span></a></h2><p>本文只实现<code>express</code>获取IP的方案，具体获取详细地址以及运营商等信息，请查阅详细资料</p>`,11))])}const h=a(t,[["render",p],["__file","ip.html.vue"]]),m=JSON.parse('{"path":"/posts/ip.html","title":"🏔️获取IP方案","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2024-05-10T00:00:00.000Z","category":["业务"],"tag":["一般"],"head":[["meta",{"property":"og:url","content":"https://github.com/lawther1206/my-docs/posts/ip.html"}],["meta",{"property":"og:title","content":"🏔️获取IP方案"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-02-17T08:43:41.000Z"}],["meta",{"property":"article:tag","content":"一般"}],["meta",{"property":"article:published_time","content":"2024-05-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-17T08:43:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"🏔️获取IP方案\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-05-10T00:00:00.000Z\\",\\"dateModified\\":\\"2025-02-17T08:43:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"leeyng\\",\\"url\\":\\"\\"}]}"]]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"方案一","slug":"方案一","link":"#方案一","children":[]},{"level":2,"title":"方案二","slug":"方案二","link":"#方案二","children":[]},{"level":2,"title":"最后","slug":"最后","link":"#最后","children":[]}],"git":{"createdTime":1739781821000,"updatedTime":1739781821000,"contributors":[{"name":"liyong","username":"liyong","email":"1074681225@qq.com","commits":1,"url":"https://github.com/liyong"}]},"readingTime":{"minutes":1.01,"words":304},"filePathRelative":"posts/ip.md","localizedDate":"2024年5月10日","excerpt":"\\n"}');export{h as comp,m as data};
